
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../math/">
      
      
        <link rel="next" href="../build/background/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.12">
    
    
      
        <title>Toliman - TOLIMAN</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TOLIMAN" class="md-header__button md-logo" aria-label="TOLIMAN" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TOLIMAN
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Toliman
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TOLIMAN" class="md-nav__button md-logo" aria-label="TOLIMAN" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    TOLIMAN
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        CONTRIBUTING
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALLATION/" class="md-nav__link">
        INSTALLATION
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../LICENSE/" class="md-nav__link">
        LICENSE
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/gradient_descent/" class="md-nav__link">
        Gradient descent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/hmc/" class="md-nav__link">
        Hmc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Toliman
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Toliman
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../collections/" class="md-nav__link">
        Collections
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        Io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../math/" class="md-nav__link">
        Math
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Toliman
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Toliman
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector" class="md-nav__link">
    toliman.toliman.TolimanDetector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.append" class="md-nav__link">
    append()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.insert" class="md-nav__link">
    insert()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.pop" class="md-nav__link">
    pop()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.remove" class="md-nav__link">
    remove()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.to_optics_list" class="md-nav__link">
    to_optics_list()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics" class="md-nav__link">
    toliman.toliman.TolimanOptics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.append" class="md-nav__link">
    append()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.insert" class="md-nav__link">
    insert()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.pop" class="md-nav__link">
    pop()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.remove" class="md-nav__link">
    remove()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.to_optics_list" class="md-nav__link">
    to_optics_list()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.AlphaCentauri" class="md-nav__link">
    toliman.toliman.AlphaCentauri
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.AlphaCentauri.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.Background" class="md-nav__link">
    toliman.toliman.Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.Background.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
          Build
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          Build
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build/background/" class="md-nav__link">
        Background
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build/build/" class="md-nav__link">
        Build
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build/https/" class="md-nav__link">
        Https
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build/mask/" class="md-nav__link">
        Mask
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build/paths/" class="md-nav__link">
        Paths
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build/phoenix/" class="md-nav__link">
        Phoenix
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector" class="md-nav__link">
    toliman.toliman.TolimanDetector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.append" class="md-nav__link">
    append()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.insert" class="md-nav__link">
    insert()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.pop" class="md-nav__link">
    pop()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.remove" class="md-nav__link">
    remove()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanDetector.to_optics_list" class="md-nav__link">
    to_optics_list()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics" class="md-nav__link">
    toliman.toliman.TolimanOptics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.append" class="md-nav__link">
    append()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.insert" class="md-nav__link">
    insert()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.pop" class="md-nav__link">
    pop()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.remove" class="md-nav__link">
    remove()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.TolimanOptics.to_optics_list" class="md-nav__link">
    to_optics_list()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.AlphaCentauri" class="md-nav__link">
    toliman.toliman.AlphaCentauri
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.AlphaCentauri.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.Background" class="md-nav__link">
    toliman.toliman.Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toliman.toliman.Background.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Toliman</h1>

<h2 id="overview">Overview</h2>
<p>This file, amongst everything else contains the core optics of the <code>toliman</code> 
forwards model. The basic concept is that each component of the model is 
a specialisation (this is a type of inheritance) of a more general component.
Deciding what level of detail to include was very arbitrary. In some senses,
jut adding the pupil and the mask to the optics made the most sense as it 
gave the user the freedom to add other layers as they saw fit. But, in the 
end I decided that the simplest API was probably the best and so tried to 
include as much detail as possible. This is something that might change as
the model is used. The current model of the detector is a placeholder, since 
the actual physical detector has not been selected. As a result we cannot 
work with real values yet or include too much detail. </p>
<p>There is a lot that can still be done with the forwards model, such as Fresnel
calculations, secondary mirror polish and sidelobes. Unfortunately, I never
got a chance to look into the sidelobes although it was high on my priority 
list. The problem is that acurrately simulating the diffraction grating 
requires very high sampling. In order to reduce the computation cost it was 
proposed that we avoid as many layers as possible when simulating the sidelobes
including only the aberrations. This then leads to complexity when considering 
how to make sure that the aberrations are shared between the models. </p>
<h2 id="api">API</h2>
<details class="note">
<summary><code>TolimanDetector</code></summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-class">


<a id="toliman.toliman.TolimanDetector"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dLux">dl</span>.<span title="dLux.Detector">Detector</span></code>, <code><span title="toliman.collections">collections</span>.<a class="autorefs autorefs-internal" title="toliman.collections.CollectionInterface" href="../collections/#toliman.collections.CollectionInterface">CollectionInterface</a></code></p>

  
      <p>Represents the Toliman detector.</p>
<p>A default implementation of a generic detector that is designed
to be used with the <code>dLux.Instrument</code>.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">toliman_detector</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">TolimanDetector</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">toliman_detector</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">TolimanDetector</span><span class="p">(</span><span class="n">simulate_jitter</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>toliman/toliman.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TolimanDetector</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">Detector</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">CollectionInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the Toliman detector.</span>

<span class="sd">    A default implementation of a generic detector that is designed</span>
<span class="sd">    to be used with the `dLux.Instrument`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```py</span>
<span class="sd">    &gt;&gt;&gt; toliman_detector: object = TolimanDetector()</span>
<span class="sd">    &gt;&gt;&gt; toliman_detector: object = TolimanDetector(simulate_jitter = False)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
        <span class="n">simulate_jitter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">simulate_pixel_response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">simulate_saturation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">extra_detector_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the Toliman detector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        simulate_jitter: bool = True</span>
<span class="sd">            True if jitter should be included in the simulation of the</span>
<span class="sd">            detector.</span>
<span class="sd">        simulate_pixel_response: bool = True</span>
<span class="sd">            True if a pixel response should be included in the simulation</span>
<span class="sd">            of the detector.</span>
<span class="sd">        simulate_saturation: bool = True</span>
<span class="sd">            True if staturation should be included in the simulation of</span>
<span class="sd">            the detector.</span>
<span class="sd">        extra_detector_layers: list = []</span>
<span class="sd">            Extra detector effects besides the default ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DETECTOR_REPEATED_ERR_MSG</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        You have provided a layer that is also a default layer. Make sure </span>
<span class="s2">        that each type of detector is only provided once. </span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">DEFAULT_DETECTOR_JITTER</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;DEFAULT_DETECTOR_JITTER&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">DEFAULT_DETECTOR_SATURATION</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;DEFAULT_DETECTOR_SATURATION&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">DEFAULT_DETECTOR_NPIX</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;DEFAULT_DETECTOR_NPIX&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">DEFAULT_DETECTOR_THRESHOLD</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;DEFAULT_DETECTOR_THRESHOLD&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

        <span class="n">detector_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">simulate_jitter</span><span class="p">:</span>
            <span class="n">detector_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">ApplyJitter</span><span class="p">(</span><span class="n">DEFAULT_DETECTOR_JITTER</span><span class="p">))</span>

            <span class="c1"># TODO: Make a contains instance function</span>
            <span class="k">if</span> <span class="n">collections</span><span class="o">.</span><span class="n">contains_instance</span><span class="p">(</span><span class="n">extra_detector_layers</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApplyJitter</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">DETECTOR_REPEATED_ERR_MSG</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">simulate_saturation</span><span class="p">:</span>
            <span class="n">detector_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">ApplySaturation</span><span class="p">(</span><span class="n">DEFAULT_DETECTOR_SATURATION</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">collections</span><span class="o">.</span><span class="n">contains_instance</span><span class="p">(</span><span class="n">extra_detector_layers</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApplySaturation</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">DETECTOR_REPEATED_ERR_MSG</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">simulate_pixel_response</span><span class="p">:</span>
            <span class="n">detector_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">dl</span><span class="o">.</span><span class="n">ApplyPixelResponse</span><span class="p">(</span>
                    <span class="n">math</span><span class="o">.</span><span class="n">pixel_response</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">DEFAULT_DETECTOR_NPIX</span><span class="p">,</span> <span class="n">DEFAULT_DETECTOR_NPIX</span><span class="p">),</span>
                        <span class="n">DEFAULT_DETECTOR_THRESHOLD</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">collections</span><span class="o">.</span><span class="n">contains_instance</span><span class="p">(</span><span class="n">extra_detector_layers</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApplyPixelResponse</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">DETECTOR_REPEATED_ERR_MSG</span><span class="p">)</span>

        <span class="n">detector_layers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_detector_layers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">detector_layers</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">detector_layers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;You have provided no detector layers and not asked &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;for any of the defaults. This implies that the detector &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;does not contain any layers which is not a valid state. &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;If you do not wish to model any detector effects do not &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;provide a detector in construction.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_optics_list</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the optical elements that make up the object as a list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        optics: list</span>
<span class="sd">            The optical layers in order in a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">optic</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an additional layer to the optical system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        optic: object</span>
<span class="sd">            A `dLux.OpticalLayer` to include in the model.</span>
<span class="sd">        index: int</span>
<span class="sd">            Where in the list of layers to add optic.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        toliman: TolimanOptics</span>
<span class="sd">            A new `TolimanOptics` instance with the applied update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">DetectorLayer</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inserted optics must be optical layers.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be positive.&quot;</span><span class="p">)</span>

        <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` is outside the layers.&quot;</span><span class="p">)</span>

        <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">optic</span><span class="p">)</span>
        <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take a layer from the optical system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: int</span>
<span class="sd">            Where in the list of layers to remove an optic.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        toliman: TolimanOptics</span>
<span class="sd">            A new `TolimanOptics` instance with the applied update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be positive.&quot;</span><span class="p">)</span>

        <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be within the detector.&quot;</span><span class="p">)</span>

        <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">optic</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Place a new optic at the end of the optical system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        optic: object</span>
<span class="sd">            The optic to include. It must be a subclass of the</span>
<span class="sd">            `dLux.OpticalLayer`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        optics: object</span>
<span class="sd">            The new optical system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">DetectorLayer</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inserted optics must be a detector layer.&quot;</span><span class="p">)</span>

        <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
        <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optic</span><span class="p">)</span>
        <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the last element in the optical system.</span>

<span class="sd">        Please note that this differs from the `.pop` method of</span>
<span class="sd">        the `list` class  because it does not return the popped element.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        optics: object</span>
<span class="sd">            The optical system with the layer removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
        <span class="n">_</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanDetector.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">simulate_jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simulate_pixel_response</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simulate_saturation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extra_detector_layers</span><span class="o">=</span><span class="p">[])</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simulate the Toliman detector.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>simulate_jitter</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>True if jitter should be included in the simulation of the
detector.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>simulate_pixel_response</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>True if a pixel response should be included in the simulation
of the detector.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>simulate_saturation</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>True if staturation should be included in the simulation of
the detector.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>extra_detector_layers</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Extra detector effects besides the default ones.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
    <span class="n">simulate_jitter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">simulate_pixel_response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">simulate_saturation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">extra_detector_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate the Toliman detector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulate_jitter: bool = True</span>
<span class="sd">        True if jitter should be included in the simulation of the</span>
<span class="sd">        detector.</span>
<span class="sd">    simulate_pixel_response: bool = True</span>
<span class="sd">        True if a pixel response should be included in the simulation</span>
<span class="sd">        of the detector.</span>
<span class="sd">    simulate_saturation: bool = True</span>
<span class="sd">        True if staturation should be included in the simulation of</span>
<span class="sd">        the detector.</span>
<span class="sd">    extra_detector_layers: list = []</span>
<span class="sd">        Extra detector effects besides the default ones.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DETECTOR_REPEATED_ERR_MSG</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You have provided a layer that is also a default layer. Make sure </span>
<span class="s2">    that each type of detector is only provided once. </span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_DETECTOR_JITTER</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;DEFAULT_DETECTOR_JITTER&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">DEFAULT_DETECTOR_SATURATION</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;DEFAULT_DETECTOR_SATURATION&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">DEFAULT_DETECTOR_NPIX</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;DEFAULT_DETECTOR_NPIX&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">DEFAULT_DETECTOR_THRESHOLD</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;DEFAULT_DETECTOR_THRESHOLD&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="n">detector_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">simulate_jitter</span><span class="p">:</span>
        <span class="n">detector_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">ApplyJitter</span><span class="p">(</span><span class="n">DEFAULT_DETECTOR_JITTER</span><span class="p">))</span>

        <span class="c1"># TODO: Make a contains instance function</span>
        <span class="k">if</span> <span class="n">collections</span><span class="o">.</span><span class="n">contains_instance</span><span class="p">(</span><span class="n">extra_detector_layers</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApplyJitter</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">DETECTOR_REPEATED_ERR_MSG</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">simulate_saturation</span><span class="p">:</span>
        <span class="n">detector_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">ApplySaturation</span><span class="p">(</span><span class="n">DEFAULT_DETECTOR_SATURATION</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">collections</span><span class="o">.</span><span class="n">contains_instance</span><span class="p">(</span><span class="n">extra_detector_layers</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApplySaturation</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">DETECTOR_REPEATED_ERR_MSG</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">simulate_pixel_response</span><span class="p">:</span>
        <span class="n">detector_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">dl</span><span class="o">.</span><span class="n">ApplyPixelResponse</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">pixel_response</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">DEFAULT_DETECTOR_NPIX</span><span class="p">,</span> <span class="n">DEFAULT_DETECTOR_NPIX</span><span class="p">),</span>
                    <span class="n">DEFAULT_DETECTOR_THRESHOLD</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">collections</span><span class="o">.</span><span class="n">contains_instance</span><span class="p">(</span><span class="n">extra_detector_layers</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">ApplyPixelResponse</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">DETECTOR_REPEATED_ERR_MSG</span><span class="p">)</span>

    <span class="n">detector_layers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_detector_layers</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">detector_layers</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">detector_layers</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;You have provided no detector layers and not asked &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;for any of the defaults. This implies that the detector &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;does not contain any layers which is not a valid state. &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;If you do not wish to model any detector effects do not &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;provide a detector in construction.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanDetector.append" class="doc doc-heading">
<code class="highlight language-python"><span class="n">append</span><span class="p">(</span><span class="n">optic</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Place a new optic at the end of the optical system.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>optic</code></td>
          <td>
                <code>object</code>
          </td>
          <td><p>The optic to include. It must be a subclass of the
<code>dLux.OpticalLayer</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>optics</code></td>          <td>
                <code>object</code>
          </td>
          <td><p>The new optical system.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">optic</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Place a new optic at the end of the optical system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    optic: object</span>
<span class="sd">        The optic to include. It must be a subclass of the</span>
<span class="sd">        `dLux.OpticalLayer`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    optics: object</span>
<span class="sd">        The new optical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">DetectorLayer</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inserted optics must be a detector layer.&quot;</span><span class="p">)</span>

    <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
    <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optic</span><span class="p">)</span>
    <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanDetector.insert" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add an additional layer to the optical system.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>optic</code></td>
          <td>
                <code>object</code>
          </td>
          <td><p>A <code>dLux.OpticalLayer</code> to include in the model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Where in the list of layers to add optic.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>toliman</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="toliman.toliman.TolimanOptics" href="#toliman.toliman.TolimanOptics">TolimanOptics</a></code>
          </td>
          <td><p>A new <code>TolimanOptics</code> instance with the applied update.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">optic</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an additional layer to the optical system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    optic: object</span>
<span class="sd">        A `dLux.OpticalLayer` to include in the model.</span>
<span class="sd">    index: int</span>
<span class="sd">        Where in the list of layers to add optic.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    toliman: TolimanOptics</span>
<span class="sd">        A new `TolimanOptics` instance with the applied update.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">detectors</span><span class="o">.</span><span class="n">DetectorLayer</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inserted optics must be optical layers.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be positive.&quot;</span><span class="p">)</span>

    <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` is outside the layers.&quot;</span><span class="p">)</span>

    <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">optic</span><span class="p">)</span>
    <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanDetector.pop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pop</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Remove the last element in the optical system.</p>
<p>Please note that this differs from the <code>.pop</code> method of
the <code>list</code> class  because it does not return the popped element.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>optics</code></td>          <td>
                <code>object</code>
          </td>
          <td><p>The optical system with the layer removed.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove the last element in the optical system.</span>

<span class="sd">    Please note that this differs from the `.pop` method of</span>
<span class="sd">    the `list` class  because it does not return the popped element.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    optics: object</span>
<span class="sd">        The optical system with the layer removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
    <span class="n">_</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanDetector.remove" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Take a layer from the optical system.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Where in the list of layers to remove an optic.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>toliman</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="toliman.toliman.TolimanOptics" href="#toliman.toliman.TolimanOptics">TolimanOptics</a></code>
          </td>
          <td><p>A new <code>TolimanOptics</code> instance with the applied update.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take a layer from the optical system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    index: int</span>
<span class="sd">        Where in the list of layers to remove an optic.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    toliman: TolimanOptics</span>
<span class="sd">        A new `TolimanOptics` instance with the applied update.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be positive.&quot;</span><span class="p">)</span>

    <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be within the detector.&quot;</span><span class="p">)</span>

    <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanDetector.to_optics_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_optics_list</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get the optical elements that make up the object as a list.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>optics</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>The optical layers in order in a list.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_optics_list</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the optical elements that make up the object as a list.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    optics: list</span>
<span class="sd">        The optical layers in order in a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 data-role="class" id="toliman.toliman.TolimanDetector"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanDetector.__init__"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanDetector.append"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanDetector.insert"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanDetector.pop"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanDetector.remove"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanDetector.to_optics_list"></h2>
</div>
</details>
<details class="note">
<summary><code>TolimanOptics</code></summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-class">


<a id="toliman.toliman.TolimanOptics"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dLux">dl</span>.<span title="dLux.Optics">Optics</span></code>, <code><span title="toliman.collections">collections</span>.<a class="autorefs autorefs-internal" title="toliman.collections.CollectionInterface" href="../collections/#toliman.collections.CollectionInterface">CollectionInterface</a></code></p>

  
      <p>Simulates the optical system of the TOLIMAN telescope.</p>
<p>It is designed to occupy the <code>optics</code> kwarg of <code>dl.Instrument</code>.
The <code>TolimanOptics</code> provides a default implementation that
can be extended using the <code>.add</code> method. There are also
several ways that the <code>TolimanOptics</code> can be initialised.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code>&gt;&gt;&gt; toliman_optics: object = TolimanOptics()
&gt;&gt;&gt; toliman_optics: object = TolimanOptics(simulate_aberrations = False)
&gt;&gt;&gt; toliman_optics: object = TolimanOptics(pixels_in_pupil = 1024)
</code></pre></div>
<p>For more options run <code>help(TolimanOptics.__init__)</code>.</p>


        <details class="quote">
          <summary>Source code in <code>toliman/toliman.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TolimanOptics</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">Optics</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">CollectionInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulates the optical system of the TOLIMAN telescope.</span>

<span class="sd">    It is designed to occupy the `optics` kwarg of `dl.Instrument`.</span>
<span class="sd">    The `TolimanOptics` provides a default implementation that</span>
<span class="sd">    can be extended using the `.add` method. There are also</span>
<span class="sd">    several ways that the `TolimanOptics` can be initialised.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```</span>
<span class="sd">    &gt;&gt;&gt; toliman_optics: object = TolimanOptics()</span>
<span class="sd">    &gt;&gt;&gt; toliman_optics: object = TolimanOptics(simulate_aberrations = False)</span>
<span class="sd">    &gt;&gt;&gt; toliman_optics: object = TolimanOptics(pixels_in_pupil = 1024)</span>
<span class="sd">    ```</span>

<span class="sd">    For more options run `help(TolimanOptics.__init__)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
        <span class="n">simulate_polish</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">simulate_aberrations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">operate_in_fresnel_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">operate_in_static_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">number_of_zernikes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_NUMBER_OF_ZERNIKES&quot;</span><span class="p">]),</span>
        <span class="n">pixels_in_pupil</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_PUPIL_NPIX&quot;</span><span class="p">]),</span>
        <span class="n">pixels_on_detector</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_DETECTOR_NPIX&quot;</span><span class="p">]),</span>
        <span class="n">path_to_mask</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_MASK_DIR&quot;</span><span class="p">],</span>
        <span class="n">path_to_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;assets/filter.npy&quot;</span><span class="p">,</span>
        <span class="n">path_to_polish</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;assets/polish.npy&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the Toliman telescope.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        simulate_polish: bool = True</span>
<span class="sd">            True if a layer should be included simulating the polish</span>
<span class="sd">            on the secondary mirror.</span>
<span class="sd">        simulate_aberrations: bool = True</span>
<span class="sd">            True if the aberrations should be included.</span>
<span class="sd">        operate_in_fresnel_mode: bool = False</span>
<span class="sd">            True if the simulation should use Fresnel instead of</span>
<span class="sd">            Fourier optics.</span>
<span class="sd">        operate_in_static_mode: bool = True</span>
<span class="sd">            True if the pupil of the aperture should be modelled</span>
<span class="sd">            as static. This will improve performance so only change</span>
<span class="sd">            it if you want to learn a parameter of the aperture.</span>
<span class="sd">        number_of_zernikes: int = DEFAULT_NUMBER_OF_ZERNIKES</span>
<span class="sd">            The number of zernike polynomials that should be used</span>
<span class="sd">            to model the aberrations.</span>
<span class="sd">        pixels_in_pupil: int = DEFAULT_PUPIL_NPIX</span>
<span class="sd">            The number of pixels in the pupil plane.</span>
<span class="sd">        pixels_on_detector: int = DEFAULT_DETECTOR_NPIX</span>
<span class="sd">            The number of pixels in the detector plane.</span>
<span class="sd">        path_to_mask: str = &quot;assets/mask.npy&quot;</span>
<span class="sd">            The file location of a `.npy` file that contains an</span>
<span class="sd">            array representation o the mask.</span>
<span class="sd">        path_to_filter: str = &quot;assets/filter.npy&quot;</span>
<span class="sd">            The file location of a `.npy` file that contains an</span>
<span class="sd">            array representation og the filter.</span>
<span class="sd">        path_to_polish: str = &quot;assets/polish.npy&quot;</span>
<span class="sd">            The file location of a `.npy` file that contains an</span>
<span class="sd">            array representation of the secondary mirror polish.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PRIMARY_APERTURE_DIAMETER</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_PRIMARY_APERTURE_DIAMETER&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">NUMBER_OF_STRUTS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_NUMBER_OF_STRUTS&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">WIDTH_OF_STRUTS</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_WIDTH_OF_STRUTS&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">SECONDARY_MIRROR_DIAMETER</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_SECONDARY_MIRROR_DIAMETER&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">DETECTOR_PIXEL_SIZE</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_DETECTOR_PIXEL_SIZE&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

        <span class="n">toliman_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">dl</span><span class="o">.</span><span class="n">CreateWavefront</span><span class="p">(</span>
                <span class="n">pixels_in_pupil</span><span class="p">,</span>
                <span class="n">PRIMARY_APERTURE_DIAMETER</span><span class="p">,</span>
                <span class="n">wavefront_type</span><span class="o">=</span><span class="s2">&quot;Angular&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Adding the pupil</span>
        <span class="n">dyn_toliman_pupil</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">CompoundAperture</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">dl</span><span class="o">.</span><span class="n">UniformSpider</span><span class="p">(</span><span class="n">NUMBER_OF_STRUTS</span><span class="p">,</span> <span class="n">WIDTH_OF_STRUTS</span><span class="p">),</span>
                <span class="n">dl</span><span class="o">.</span><span class="n">AnnularAperture</span><span class="p">(</span>
                    <span class="n">PRIMARY_APERTURE_DIAMETER</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="n">SECONDARY_MIRROR_DIAMETER</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">operate_in_static_mode</span><span class="p">:</span>
            <span class="n">static_toliman_pupil</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">StaticAperture</span><span class="p">(</span>
                <span class="n">dyn_toliman_pupil</span><span class="p">,</span>
                <span class="n">npixels</span><span class="o">=</span><span class="n">pixels_in_pupil</span><span class="p">,</span>
                <span class="n">diameter</span><span class="o">=</span><span class="n">PRIMARY_APERTURE_DIAMETER</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">static_toliman_pupil</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dyn_toliman_pupil</span><span class="p">)</span>

        <span class="c1"># Loading the mask.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loaded_mask</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path_to_mask</span><span class="p">)</span>
            <span class="n">loaded_shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="n">loaded_mask</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">loaded_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">loaded_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">mask</span><span class="p">:</span> <span class="nb">float</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">loaded_width</span> <span class="o">==</span> <span class="n">pixels_in_pupil</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">loaded_width</span> <span class="o">&lt;</span> <span class="n">pixels_in_pupil</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span> 
                        <span class="s2">&quot;The mask you have loaded had a higher resolution &quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;than the pupil. A method of resolving this has not &quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;yet been created. Either change the value of the &quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;`DEFAULT_PUPIL_NPIX` constant or use a different mask.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">loaded_width</span> <span class="o">%</span> <span class="n">pixels_in_pupil</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">downsample_by</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">loaded_width</span> <span class="o">//</span> <span class="n">pixels_in_pupil</span>
                    <span class="n">mask</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">downsample_square_grid</span><span class="p">(</span><span class="n">loaded_mask</span><span class="p">,</span> <span class="n">downsample_by</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;The mask you have loaded could not be downsampled &quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;onto the pupil. The shape of the mask was &quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;({</span><span class="si">%i</span><span class="s2">, </span><span class="si">%i</span><span class="s2">}). Either change the value of the &quot;</span>
                        <span class="s2">&quot;environment variable `DEFAULT_PUPIL_NPIX` or use &quot;</span> <span class="o">+</span>\
                        <span class="s2">&quot;a different mask.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loaded_width</span><span class="p">,</span> <span class="n">loaded_width</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">loaded_mask</span>

            <span class="k">del</span> <span class="n">loaded_mask</span>
            <span class="k">del</span> <span class="n">loaded_shape</span>
            <span class="k">del</span> <span class="n">loaded_width</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The file address that of the mask did not exist. &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;Make sure that you have a `.npy` representation of the &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;phase mask available and have provided the correct file &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;address to the constructor.&quot;</span>
            <span class="p">)</span>

        <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">AddOPD</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>

        <span class="c1"># Generating the Zernikes</span>
        <span class="c1"># TODO: Make zernike_coefficients a function</span>
        <span class="k">if</span> <span class="n">simulate_aberrations</span><span class="p">:</span>
            <span class="n">nolls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">number_of_zernikes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">seed</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">coeffs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="mf">1e-08</span> <span class="o">*</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_zernikes</span><span class="p">,))</span>

            <span class="n">toliman_aberrations</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">StaticAberratedAperture</span><span class="p">(</span>
                <span class="n">dl</span><span class="o">.</span><span class="n">AberratedAperture</span><span class="p">(</span>
                    <span class="n">noll_inds</span><span class="o">=</span><span class="n">nolls</span><span class="p">,</span>
                    <span class="n">coefficients</span><span class="o">=</span><span class="n">coeffs</span><span class="p">,</span>
                    <span class="n">aperture</span><span class="o">=</span><span class="n">dl</span><span class="o">.</span><span class="n">CircularAperture</span><span class="p">(</span>
                        <span class="n">PRIMARY_APERTURE_DIAMETER</span> <span class="o">/</span> <span class="mf">2.0</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">npixels</span><span class="o">=</span><span class="n">pixels_in_pupil</span><span class="p">,</span>
                <span class="n">diameter</span><span class="o">=</span><span class="n">PRIMARY_APERTURE_DIAMETER</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toliman_aberrations</span><span class="p">)</span>

        <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">NormaliseWavefront</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">simulate_polish</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;You have requested that the mirror polish be simulated &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;this has not yet been implemented although it is planned &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;in an upcoming release.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Adding the propagator</span>
        <span class="n">toliman_body</span><span class="p">:</span> <span class="nb">object</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">operate_in_fresnel_mode</span><span class="p">:</span>
            <span class="n">toliman_body</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">AngularMFT</span><span class="p">(</span>
                <span class="n">pixels_on_detector</span><span class="p">,</span> <span class="n">DETECTOR_PIXEL_SIZE</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;You have request operation in Fresenl mode. This has &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;not currently been implemented. Once implemented it &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;is not recommended that you use the feature as it is &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;very slow and the zernike terms should be sufficient for &quot;</span> <span class="o">+</span>\
                <span class="s2">&quot;most purposes.&quot;</span>
            <span class="p">)</span>

        <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toliman_body</span><span class="p">)</span>

        <span class="c1"># Renormalising the flux.</span>
        <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">NormaliseWavefront</span><span class="p">())</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">toliman_layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_optics_list</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the optical elements that make up the object as a list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        optics: list</span>
<span class="sd">            The optical layers in order in a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">optic</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an additional layer to the optical system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        optic: object</span>
<span class="sd">            A `dLux.OpticalLayer` to include in the model.</span>
<span class="sd">        index: int</span>
<span class="sd">            Where in the list of layers to add optic.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        toliman: TolimanOptics</span>
<span class="sd">            A new `TolimanOptics` instance with the applied update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">optics</span><span class="o">.</span><span class="n">OpticalLayer</span><span class="p">):</span>
            <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">apertures</span><span class="o">.</span><span class="n">ApertureLayer</span><span class="p">):</span>
            <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">correct_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inserted optics must be optical layers.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be positive.&quot;</span><span class="p">)</span>

        <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
        <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">optic</span><span class="p">)</span>
        <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take a layer from the optical system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: int</span>
<span class="sd">            Where in the list of layers to remove an optic.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        toliman: TolimanOptics</span>
<span class="sd">            A new `TolimanOptics` instance with the applied update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be positive.&quot;</span><span class="p">)</span>

        <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be within the optical system.&quot;</span><span class="p">)</span>

        <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">optic</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Place a new optic at the end of the optical system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        optic: object</span>
<span class="sd">            The optic to include. It must be a subclass of the</span>
<span class="sd">            `dLux.OpticalLayer`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        optics: object</span>
<span class="sd">            The new optical system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">optics</span><span class="o">.</span><span class="n">OpticalLayer</span><span class="p">):</span>
            <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">apertures</span><span class="o">.</span><span class="n">ApertureLayer</span><span class="p">):</span>
            <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">correct_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inserted optics must be optical layers.&quot;</span><span class="p">)</span>

        <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
        <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optic</span><span class="p">)</span>
        <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the last element in the optical system.</span>

<span class="sd">        Please note that this differs from the `.pop` method of</span>
<span class="sd">        the `list` class  because it does not return the popped element.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        optics: object</span>
<span class="sd">            The optical system with the layer removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
        <span class="n">_</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanOptics.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">simulate_polish</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">simulate_aberrations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">operate_in_fresnel_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">operate_in_static_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">number_of_zernikes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DEFAULT_NUMBER_OF_ZERNIKES&#39;</span><span class="p">]),</span> <span class="n">pixels_in_pupil</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DEFAULT_PUPIL_NPIX&#39;</span><span class="p">]),</span> <span class="n">pixels_on_detector</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DEFAULT_DETECTOR_NPIX&#39;</span><span class="p">]),</span> <span class="n">path_to_mask</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DEFAULT_MASK_DIR&#39;</span><span class="p">],</span> <span class="n">path_to_filter</span><span class="o">=</span><span class="s1">&#39;assets/filter.npy&#39;</span><span class="p">,</span> <span class="n">path_to_polish</span><span class="o">=</span><span class="s1">&#39;assets/polish.npy&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simulate the Toliman telescope.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>simulate_polish</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>True if a layer should be included simulating the polish
on the secondary mirror.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>simulate_aberrations</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>True if the aberrations should be included.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>operate_in_fresnel_mode</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>True if the simulation should use Fresnel instead of
Fourier optics.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>operate_in_static_mode</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>True if the pupil of the aperture should be modelled
as static. This will improve performance so only change
it if you want to learn a parameter of the aperture.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>number_of_zernikes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of zernike polynomials that should be used
to model the aberrations.</p></td>
          <td>
                <code>int(os.environ[&#39;DEFAULT_NUMBER_OF_ZERNIKES&#39;])</code>
          </td>
        </tr>
        <tr>
          <td><code>pixels_in_pupil</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels in the pupil plane.</p></td>
          <td>
                <code>int(os.environ[&#39;DEFAULT_PUPIL_NPIX&#39;])</code>
          </td>
        </tr>
        <tr>
          <td><code>pixels_on_detector</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of pixels in the detector plane.</p></td>
          <td>
                <code>int(os.environ[&#39;DEFAULT_DETECTOR_NPIX&#39;])</code>
          </td>
        </tr>
        <tr>
          <td><code>path_to_mask</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The file location of a <code>.npy</code> file that contains an
array representation o the mask.</p></td>
          <td>
                <code>os.environ[&#39;DEFAULT_MASK_DIR&#39;]</code>
          </td>
        </tr>
        <tr>
          <td><code>path_to_filter</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The file location of a <code>.npy</code> file that contains an
array representation og the filter.</p></td>
          <td>
                <code>&#39;assets/filter.npy&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>path_to_polish</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The file location of a <code>.npy</code> file that contains an
array representation of the secondary mirror polish.</p></td>
          <td>
                <code>&#39;assets/polish.npy&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
    <span class="n">simulate_polish</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">simulate_aberrations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">operate_in_fresnel_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">operate_in_static_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">number_of_zernikes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_NUMBER_OF_ZERNIKES&quot;</span><span class="p">]),</span>
    <span class="n">pixels_in_pupil</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_PUPIL_NPIX&quot;</span><span class="p">]),</span>
    <span class="n">pixels_on_detector</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_DETECTOR_NPIX&quot;</span><span class="p">]),</span>
    <span class="n">path_to_mask</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_MASK_DIR&quot;</span><span class="p">],</span>
    <span class="n">path_to_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;assets/filter.npy&quot;</span><span class="p">,</span>
    <span class="n">path_to_polish</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;assets/polish.npy&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate the Toliman telescope.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulate_polish: bool = True</span>
<span class="sd">        True if a layer should be included simulating the polish</span>
<span class="sd">        on the secondary mirror.</span>
<span class="sd">    simulate_aberrations: bool = True</span>
<span class="sd">        True if the aberrations should be included.</span>
<span class="sd">    operate_in_fresnel_mode: bool = False</span>
<span class="sd">        True if the simulation should use Fresnel instead of</span>
<span class="sd">        Fourier optics.</span>
<span class="sd">    operate_in_static_mode: bool = True</span>
<span class="sd">        True if the pupil of the aperture should be modelled</span>
<span class="sd">        as static. This will improve performance so only change</span>
<span class="sd">        it if you want to learn a parameter of the aperture.</span>
<span class="sd">    number_of_zernikes: int = DEFAULT_NUMBER_OF_ZERNIKES</span>
<span class="sd">        The number of zernike polynomials that should be used</span>
<span class="sd">        to model the aberrations.</span>
<span class="sd">    pixels_in_pupil: int = DEFAULT_PUPIL_NPIX</span>
<span class="sd">        The number of pixels in the pupil plane.</span>
<span class="sd">    pixels_on_detector: int = DEFAULT_DETECTOR_NPIX</span>
<span class="sd">        The number of pixels in the detector plane.</span>
<span class="sd">    path_to_mask: str = &quot;assets/mask.npy&quot;</span>
<span class="sd">        The file location of a `.npy` file that contains an</span>
<span class="sd">        array representation o the mask.</span>
<span class="sd">    path_to_filter: str = &quot;assets/filter.npy&quot;</span>
<span class="sd">        The file location of a `.npy` file that contains an</span>
<span class="sd">        array representation og the filter.</span>
<span class="sd">    path_to_polish: str = &quot;assets/polish.npy&quot;</span>
<span class="sd">        The file location of a `.npy` file that contains an</span>
<span class="sd">        array representation of the secondary mirror polish.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PRIMARY_APERTURE_DIAMETER</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_PRIMARY_APERTURE_DIAMETER&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">NUMBER_OF_STRUTS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_NUMBER_OF_STRUTS&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">WIDTH_OF_STRUTS</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_WIDTH_OF_STRUTS&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">SECONDARY_MIRROR_DIAMETER</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_SECONDARY_MIRROR_DIAMETER&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">DETECTOR_PIXEL_SIZE</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;TOLIMAN_DETECTOR_PIXEL_SIZE&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="n">toliman_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CreateWavefront</span><span class="p">(</span>
            <span class="n">pixels_in_pupil</span><span class="p">,</span>
            <span class="n">PRIMARY_APERTURE_DIAMETER</span><span class="p">,</span>
            <span class="n">wavefront_type</span><span class="o">=</span><span class="s2">&quot;Angular&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Adding the pupil</span>
    <span class="n">dyn_toliman_pupil</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">CompoundAperture</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">dl</span><span class="o">.</span><span class="n">UniformSpider</span><span class="p">(</span><span class="n">NUMBER_OF_STRUTS</span><span class="p">,</span> <span class="n">WIDTH_OF_STRUTS</span><span class="p">),</span>
            <span class="n">dl</span><span class="o">.</span><span class="n">AnnularAperture</span><span class="p">(</span>
                <span class="n">PRIMARY_APERTURE_DIAMETER</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="n">SECONDARY_MIRROR_DIAMETER</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">operate_in_static_mode</span><span class="p">:</span>
        <span class="n">static_toliman_pupil</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">StaticAperture</span><span class="p">(</span>
            <span class="n">dyn_toliman_pupil</span><span class="p">,</span>
            <span class="n">npixels</span><span class="o">=</span><span class="n">pixels_in_pupil</span><span class="p">,</span>
            <span class="n">diameter</span><span class="o">=</span><span class="n">PRIMARY_APERTURE_DIAMETER</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">static_toliman_pupil</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dyn_toliman_pupil</span><span class="p">)</span>

    <span class="c1"># Loading the mask.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loaded_mask</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path_to_mask</span><span class="p">)</span>
        <span class="n">loaded_shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="n">loaded_mask</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">loaded_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">loaded_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">mask</span><span class="p">:</span> <span class="nb">float</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">loaded_width</span> <span class="o">==</span> <span class="n">pixels_in_pupil</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">loaded_width</span> <span class="o">&lt;</span> <span class="n">pixels_in_pupil</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span> 
                    <span class="s2">&quot;The mask you have loaded had a higher resolution &quot;</span> <span class="o">+</span>\
                    <span class="s2">&quot;than the pupil. A method of resolving this has not &quot;</span> <span class="o">+</span>\
                    <span class="s2">&quot;yet been created. Either change the value of the &quot;</span> <span class="o">+</span>\
                    <span class="s2">&quot;`DEFAULT_PUPIL_NPIX` constant or use a different mask.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">loaded_width</span> <span class="o">%</span> <span class="n">pixels_in_pupil</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">downsample_by</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">loaded_width</span> <span class="o">//</span> <span class="n">pixels_in_pupil</span>
                <span class="n">mask</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">downsample_square_grid</span><span class="p">(</span><span class="n">loaded_mask</span><span class="p">,</span> <span class="n">downsample_by</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The mask you have loaded could not be downsampled &quot;</span> <span class="o">+</span>\
                    <span class="s2">&quot;onto the pupil. The shape of the mask was &quot;</span> <span class="o">+</span>\
                    <span class="s2">&quot;({</span><span class="si">%i</span><span class="s2">, </span><span class="si">%i</span><span class="s2">}). Either change the value of the &quot;</span>
                    <span class="s2">&quot;environment variable `DEFAULT_PUPIL_NPIX` or use &quot;</span> <span class="o">+</span>\
                    <span class="s2">&quot;a different mask.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loaded_width</span><span class="p">,</span> <span class="n">loaded_width</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">loaded_mask</span>

        <span class="k">del</span> <span class="n">loaded_mask</span>
        <span class="k">del</span> <span class="n">loaded_shape</span>
        <span class="k">del</span> <span class="n">loaded_width</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The file address that of the mask did not exist. &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;Make sure that you have a `.npy` representation of the &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;phase mask available and have provided the correct file &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;address to the constructor.&quot;</span>
        <span class="p">)</span>

    <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">AddOPD</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>

    <span class="c1"># Generating the Zernikes</span>
    <span class="c1"># TODO: Make zernike_coefficients a function</span>
    <span class="k">if</span> <span class="n">simulate_aberrations</span><span class="p">:</span>
        <span class="n">nolls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">number_of_zernikes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">coeffs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="mf">1e-08</span> <span class="o">*</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_zernikes</span><span class="p">,))</span>

        <span class="n">toliman_aberrations</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">StaticAberratedAperture</span><span class="p">(</span>
            <span class="n">dl</span><span class="o">.</span><span class="n">AberratedAperture</span><span class="p">(</span>
                <span class="n">noll_inds</span><span class="o">=</span><span class="n">nolls</span><span class="p">,</span>
                <span class="n">coefficients</span><span class="o">=</span><span class="n">coeffs</span><span class="p">,</span>
                <span class="n">aperture</span><span class="o">=</span><span class="n">dl</span><span class="o">.</span><span class="n">CircularAperture</span><span class="p">(</span>
                    <span class="n">PRIMARY_APERTURE_DIAMETER</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="n">npixels</span><span class="o">=</span><span class="n">pixels_in_pupil</span><span class="p">,</span>
            <span class="n">diameter</span><span class="o">=</span><span class="n">PRIMARY_APERTURE_DIAMETER</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toliman_aberrations</span><span class="p">)</span>

    <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">NormaliseWavefront</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">simulate_polish</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;You have requested that the mirror polish be simulated &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;this has not yet been implemented although it is planned &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;in an upcoming release.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Adding the propagator</span>
    <span class="n">toliman_body</span><span class="p">:</span> <span class="nb">object</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">operate_in_fresnel_mode</span><span class="p">:</span>
        <span class="n">toliman_body</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">AngularMFT</span><span class="p">(</span>
            <span class="n">pixels_on_detector</span><span class="p">,</span> <span class="n">DETECTOR_PIXEL_SIZE</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;You have request operation in Fresenl mode. This has &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;not currently been implemented. Once implemented it &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;is not recommended that you use the feature as it is &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;very slow and the zernike terms should be sufficient for &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;most purposes.&quot;</span>
        <span class="p">)</span>

    <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toliman_body</span><span class="p">)</span>

    <span class="c1"># Renormalising the flux.</span>
    <span class="n">toliman_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">NormaliseWavefront</span><span class="p">())</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">toliman_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanOptics.append" class="doc doc-heading">
<code class="highlight language-python"><span class="n">append</span><span class="p">(</span><span class="n">optic</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Place a new optic at the end of the optical system.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>optic</code></td>
          <td>
                <code>object</code>
          </td>
          <td><p>The optic to include. It must be a subclass of the
<code>dLux.OpticalLayer</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>optics</code></td>          <td>
                <code>object</code>
          </td>
          <td><p>The new optical system.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">optic</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Place a new optic at the end of the optical system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    optic: object</span>
<span class="sd">        The optic to include. It must be a subclass of the</span>
<span class="sd">        `dLux.OpticalLayer`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    optics: object</span>
<span class="sd">        The new optical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">optics</span><span class="o">.</span><span class="n">OpticalLayer</span><span class="p">):</span>
        <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">apertures</span><span class="o">.</span><span class="n">ApertureLayer</span><span class="p">):</span>
        <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">correct_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inserted optics must be optical layers.&quot;</span><span class="p">)</span>

    <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
    <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optic</span><span class="p">)</span>
    <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanOptics.insert" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add an additional layer to the optical system.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>optic</code></td>
          <td>
                <code>object</code>
          </td>
          <td><p>A <code>dLux.OpticalLayer</code> to include in the model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Where in the list of layers to add optic.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>toliman</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="toliman.toliman.TolimanOptics" href="#toliman.toliman.TolimanOptics">TolimanOptics</a></code>
          </td>
          <td><p>A new <code>TolimanOptics</code> instance with the applied update.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">optic</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an additional layer to the optical system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    optic: object</span>
<span class="sd">        A `dLux.OpticalLayer` to include in the model.</span>
<span class="sd">    index: int</span>
<span class="sd">        Where in the list of layers to add optic.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    toliman: TolimanOptics</span>
<span class="sd">        A new `TolimanOptics` instance with the applied update.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">optics</span><span class="o">.</span><span class="n">OpticalLayer</span><span class="p">):</span>
        <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optic</span><span class="p">,</span> <span class="n">dl</span><span class="o">.</span><span class="n">apertures</span><span class="o">.</span><span class="n">ApertureLayer</span><span class="p">):</span>
        <span class="n">correct_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">correct_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inserted optics must be optical layers.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be positive.&quot;</span><span class="p">)</span>

    <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
    <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">optic</span><span class="p">)</span>
    <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanOptics.pop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pop</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Remove the last element in the optical system.</p>
<p>Please note that this differs from the <code>.pop</code> method of
the <code>list</code> class  because it does not return the popped element.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>optics</code></td>          <td>
                <code>object</code>
          </td>
          <td><p>The optical system with the layer removed.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove the last element in the optical system.</span>

<span class="sd">    Please note that this differs from the `.pop` method of</span>
<span class="sd">    the `list` class  because it does not return the popped element.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    optics: object</span>
<span class="sd">        The optical system with the layer removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
    <span class="n">_</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanOptics.remove" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Take a layer from the optical system.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Where in the list of layers to remove an optic.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>toliman</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="toliman.toliman.TolimanOptics" href="#toliman.toliman.TolimanOptics">TolimanOptics</a></code>
          </td>
          <td><p>A new <code>TolimanOptics</code> instance with the applied update.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take a layer from the optical system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    index: int</span>
<span class="sd">        Where in the list of layers to remove an optic.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    toliman: TolimanOptics</span>
<span class="sd">        A new `TolimanOptics` instance with the applied update.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be positive.&quot;</span><span class="p">)</span>

    <span class="n">new_layers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_optics_list</span><span class="p">()</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`index` must be within the optical system.&quot;</span><span class="p">)</span>

    <span class="n">_</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">new_layers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">dl_new_layers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">list_to_dictionary</span><span class="p">(</span><span class="n">new_layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eqx</span><span class="o">.</span><span class="n">tree_at</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dl_new_layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.TolimanOptics.to_optics_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_optics_list</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get the optical elements that make up the object as a list.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>optics</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>The optical layers in order in a list.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_optics_list</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the optical elements that make up the object as a list.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    optics: list</span>
<span class="sd">        The optical layers in order in a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 data-role="class" id="toliman.toliman.TolimanOptics"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanOptics.__init__"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanOptics.append"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanOptics.insert"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanOptics.pop"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanOptics.remove"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.TolimanOptics.to_optics_list"></h2>
</div>
</details>
<details class="note">
<summary><code>AlphaCentauri</code></summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-class">


<a id="toliman.toliman.AlphaCentauri"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dLux">dl</span>.<span title="dLux.BinarySource">BinarySource</span></code></p>

  
      <p>A convinient representation of the Alpha Centauri binary system.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">alpha_cen</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">AlphaCentauri</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wavelengths</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-09</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">595.</span><span class="p">,</span> <span class="mf">695.</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fluxes</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">spectrum</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">ArraySpectrum</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">fluxes</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">alpha_cen</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">AlphaCentauri</span><span class="p">(</span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">)</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>toliman/toliman.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AlphaCentauri</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">BinarySource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A convinient representation of the Alpha Centauri binary system.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; alpha_cen: object = AlphaCentauri()</span>
<span class="sd">    &gt;&gt;&gt; wavelengths: float = 1e-09 * np.linspace(595., 695., 10)</span>
<span class="sd">    &gt;&gt;&gt; fluxes: float = np.ones((10,), dtype = float)</span>
<span class="sd">    &gt;&gt;&gt; spectrum: object = dl.ArraySpectrum(wavelengths, fluxes)</span>
<span class="sd">    &gt;&gt;&gt; alpha_cen: object = AlphaCentauri(spectrum = spectrum)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate Alpha Centauri.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spectrum: float = None</span>
<span class="sd">            A `dl.Spectrum` if the default is not to be used. Recall</span>
<span class="sd">            that the convinience method `_simulate_alpha_cen_spectrum`</span>
<span class="sd">            can be used to simulate the spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SPECTRUM_DIR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;SPECTRUM_DIR&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> 

        <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrum</span><span class="p">:</span>
            <span class="n">_spectrum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_csv_to_jax_array</span><span class="p">(</span><span class="n">SPECTRUM_DIR</span><span class="p">)</span> 

            <span class="n">alpha_cen_a_waves</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">alpha_cen_b_waves</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">alpha_cen_a_flux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">alpha_cen_b_flux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>

            <span class="n">alpha_cen_waves</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">alpha_cen_a_waves</span><span class="p">,</span> <span class="n">alpha_cen_b_waves</span><span class="p">])</span>
            <span class="n">alpha_cen_flux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">alpha_cen_a_flux</span><span class="p">,</span> <span class="n">alpha_cen_b_flux</span><span class="p">])</span>

            <span class="n">spectrum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">CombinedSpectrum</span><span class="p">(</span>
                <span class="n">wavelengths</span><span class="o">=</span><span class="n">alpha_cen_waves</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">alpha_cen_flux</span>
            <span class="p">)</span>

        <span class="n">ALPHA_CENTAURI_POSITION</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_POSITION&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="n">ALPHA_CENTAURI_MEAN_FLUX</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_MEAN_FLUX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">ALPHA_CENTAURI_CONTRAST</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_CONTRAST&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">ALPHA_CENTAURI_SEPARATION</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_SEPARATION&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">ALPHA_CENTAURI_POSITION_ANGLE</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_POSITION_ANGLE&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_POSITION</span><span class="p">,</span>
            <span class="n">flux</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_MEAN_FLUX</span><span class="p">,</span>
            <span class="n">contrast</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_CONTRAST</span><span class="p">,</span>
            <span class="n">separation</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_SEPARATION</span><span class="p">,</span>
            <span class="n">position_angle</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_POSITION_ANGLE</span><span class="p">,</span>
            <span class="n">spectrum</span><span class="o">=</span><span class="n">spectrum</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.AlphaCentauri.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">spectrum</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simulate Alpha Centauri.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>spectrum</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>A <code>dl.Spectrum</code> if the default is not to be used. Recall
that the convinience method <code>_simulate_alpha_cen_spectrum</code>
can be used to simulate the spectrum.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate Alpha Centauri.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spectrum: float = None</span>
<span class="sd">        A `dl.Spectrum` if the default is not to be used. Recall</span>
<span class="sd">        that the convinience method `_simulate_alpha_cen_spectrum`</span>
<span class="sd">        can be used to simulate the spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SPECTRUM_DIR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;SPECTRUM_DIR&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> 

    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrum</span><span class="p">:</span>
        <span class="n">_spectrum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_csv_to_jax_array</span><span class="p">(</span><span class="n">SPECTRUM_DIR</span><span class="p">)</span> 

        <span class="n">alpha_cen_a_waves</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">alpha_cen_b_waves</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">alpha_cen_a_flux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">alpha_cen_b_flux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>

        <span class="n">alpha_cen_waves</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">alpha_cen_a_waves</span><span class="p">,</span> <span class="n">alpha_cen_b_waves</span><span class="p">])</span>
        <span class="n">alpha_cen_flux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">alpha_cen_a_flux</span><span class="p">,</span> <span class="n">alpha_cen_b_flux</span><span class="p">])</span>

        <span class="n">spectrum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">CombinedSpectrum</span><span class="p">(</span>
            <span class="n">wavelengths</span><span class="o">=</span><span class="n">alpha_cen_waves</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">alpha_cen_flux</span>
        <span class="p">)</span>

    <span class="n">ALPHA_CENTAURI_POSITION</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_POSITION&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
    <span class="n">ALPHA_CENTAURI_MEAN_FLUX</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_MEAN_FLUX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">ALPHA_CENTAURI_CONTRAST</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_CONTRAST&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">ALPHA_CENTAURI_SEPARATION</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_SEPARATION&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">ALPHA_CENTAURI_POSITION_ANGLE</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;ALPHA_CENTAURI_POSITION_ANGLE&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">position</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_POSITION</span><span class="p">,</span>
        <span class="n">flux</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_MEAN_FLUX</span><span class="p">,</span>
        <span class="n">contrast</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_CONTRAST</span><span class="p">,</span>
        <span class="n">separation</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_SEPARATION</span><span class="p">,</span>
        <span class="n">position_angle</span><span class="o">=</span><span class="n">ALPHA_CENTAURI_POSITION_ANGLE</span><span class="p">,</span>
        <span class="n">spectrum</span><span class="o">=</span><span class="n">spectrum</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 data-role="class" id="toliman.toliman.AlphaCentauri"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.AlphaCentauri.__init__"></h2>
</div>
</details>
<details class="note">
<summary><code>Background</code></summary>
<div class="mkdocstrings">

<div class="doc doc-object doc-class">


<a id="toliman.toliman.Background"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dLux">dl</span>.<span title="dLux.MultiPointSource">MultiPointSource</span></code></p>

  
      <p>Simplies the creation of a sample of background stars.</p>
<p>The sample of background stars is pulled from the Gaia database
but there is some voodoo involved in regularising the data.
Use the <code>_simulate_background_stars</code> function to generate
alternative samples.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">bg</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">Background</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lim_bg</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">Background</span><span class="p">(</span><span class="n">number_of_bg_stars</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>toliman/toliman.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Background</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">MultiPointSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplies the creation of a sample of background stars.</span>

<span class="sd">    The sample of background stars is pulled from the Gaia database</span>
<span class="sd">    but there is some voodoo involved in regularising the data.</span>
<span class="sd">    Use the `_simulate_background_stars` function to generate</span>
<span class="sd">    alternative samples.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; bg: object = Background()</span>
<span class="sd">    &gt;&gt;&gt; lim_bg: object = Background(number_of_bg_stars = 10)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">number_of_bg_stars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate background stars.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number_of_bg_stars: int = None</span>
<span class="sd">            How many background stars should be simulated.</span>
<span class="sd">        spectrum: object = None</span>
<span class="sd">            A `dl.Spectrum` if the default spectrum is not to be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">FILTER_MIN_WAVELENGTH</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;FILTER_MIN_WAVELENGTH&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">FILTER_MAX_WAVELENGTH</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;FILTER_MAX_WAVELENGTH&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">BG_DEF_SPEC_RES</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;BACKGROUND_STAR_SPEC_RES&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">BACKGROUND_DIR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;BACKGROUND_DIR&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> 

        <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrum</span><span class="p">:</span>
            <span class="n">spectrum</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">ArraySpectrum</span><span class="p">(</span>
                <span class="n">wavelengths</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                    <span class="n">FILTER_MIN_WAVELENGTH</span><span class="p">,</span> <span class="n">FILTER_MAX_WAVELENGTH</span><span class="p">,</span> <span class="n">BG_DEF_SPEC_RES</span>
                <span class="p">),</span>
                <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">BG_DEF_SPEC_RES</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># TODO: Better error handling if BACKGROUND_DIR is not valid</span>
        <span class="n">_background</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_csv_to_jax_array</span><span class="p">(</span><span class="n">BACKGROUND_DIR</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">number_of_bg_stars</span><span class="p">:</span>
            <span class="n">select_by</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">_background</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">number_of_bg_stars</span>
            <span class="n">_background</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_background</span><span class="p">[::</span><span class="n">select_by</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">position</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">_background</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">flux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">_background</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">=</span><span class="n">spectrum</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="toliman.toliman.Background.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">number_of_bg_stars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simulate background stars.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>number_of_bg_stars</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>How many background stars should be simulated.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>spectrum</code></td>
          <td>
                <code>object</code>
          </td>
          <td><p>A <code>dl.Spectrum</code> if the default spectrum is not to be used.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>toliman/toliman.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">number_of_bg_stars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate background stars.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    number_of_bg_stars: int = None</span>
<span class="sd">        How many background stars should be simulated.</span>
<span class="sd">    spectrum: object = None</span>
<span class="sd">        A `dl.Spectrum` if the default spectrum is not to be used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FILTER_MIN_WAVELENGTH</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;FILTER_MIN_WAVELENGTH&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">FILTER_MAX_WAVELENGTH</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;FILTER_MAX_WAVELENGTH&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">BG_DEF_SPEC_RES</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;BACKGROUND_STAR_SPEC_RES&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">BACKGROUND_DIR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">get_const_as_type</span><span class="p">(</span><span class="s2">&quot;BACKGROUND_DIR&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> 

    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrum</span><span class="p">:</span>
        <span class="n">spectrum</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">ArraySpectrum</span><span class="p">(</span>
            <span class="n">wavelengths</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">FILTER_MIN_WAVELENGTH</span><span class="p">,</span> <span class="n">FILTER_MAX_WAVELENGTH</span><span class="p">,</span> <span class="n">BG_DEF_SPEC_RES</span>
            <span class="p">),</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">BG_DEF_SPEC_RES</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># TODO: Better error handling if BACKGROUND_DIR is not valid</span>
    <span class="n">_background</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_csv_to_jax_array</span><span class="p">(</span><span class="n">BACKGROUND_DIR</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">number_of_bg_stars</span><span class="p">:</span>
        <span class="n">select_by</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">_background</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">number_of_bg_stars</span>
        <span class="n">_background</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">_background</span><span class="p">[::</span><span class="n">select_by</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">position</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">_background</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">flux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">*</span> <span class="n">_background</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">=</span><span class="n">spectrum</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 data-role="class" id="toliman.toliman.Background"></h2>
<h2 class="doc doc-heading" data-role="function" id="toliman.toliman.Background.__init__"></h2>
</div>
</details>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.4b2c34cd.min.js"></script>
      
    
  </body>
</html>